<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pakmall.mapper.AdProductMapper">

	<!-- 1차 카테고리 리스트 -->
	<select id="getCategoryList" resultType="com.pakmall.domain.CategoryVO">
		select cg_code, cg_code_prt, cg_name from category_tbl
		where cg_code_prt is null
	</select>
	
	<!-- 2차 카테고리 리스트 -->
	<select id="getSubCategoryList" resultType="com.pakmall.domain.CategoryVO">
		select cg_code, cg_code_prt, cg_name from category_tbl
		where cg_code_prt = #{cg_code}
	</select>

	<!-- 상품등록 -->
	<insert id="product_insert">
		insert into product_tbl(pdt_num, cg_code, cg_code_prt, pdt_name, pdt_price, pdt_discount, pdt_company, pdt_detail, pdt_img, pdt_amount, pdt_buy)
		values(seq_pdt_num.nextval, #{cg_code}, #{cg_code_prt}, #{pdt_name}, #{pdt_price}, #{pdt_discount}, #{pdt_company}, #{pdt_detail}, #{pdt_img}, #{pdt_amount}, #{pdt_buy})
	</insert>
	
	<!-- 상품수정 -->
	<update id="product_modifyOK">
		update product_tbl
			set cg_code = #{cg_code},
				cg_code_prt = #{cg_code_prt},
				pdt_name = #{pdt_name},
				pdt_price = #{pdt_price},
				pdt_discount = #{pdt_discount},
				pdt_company = #{pdt_company},
				pdt_detail = #{pdt_detail},
				pdt_img = #{pdt_img}, 
				pdt_amount = #{pdt_amount}, 
				pdt_buy = #{pdt_buy},
				pdt_date_up = sysdate
			
		where pdt_num = #{pdt_num}
	</update>
	
	<!-- 검색기능 -->
	<!-- <sql>태그는 include목적으로 사용 -->
	<sql id="criteria" >
		<trim prefix="(" suffix=") and" prefixOverrides="OR" >
			<foreach item="type" collection="typeArr">
				<trim prefix="OR" >
					<choose>
						<when test="type == 'N'.toString()" >
							pdt_name like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'D'.toString()" >
							pdt_detail like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'C'.toString()" >
							pdt_company like '%' || #{keyword} || '%'
						</when>
					</choose>
				</trim>
			</foreach>
 		</trim>
	</sql>
	
	<!-- 상품리스트 -->
	<select id="product_list" resultType="com.pakmall.domain.ProductVO" >
	<![CDATA[
		select pdt_num, cg_code, cg_code_prt, pdt_name, pdt_price, pdt_discount, 
	    		pdt_company, pdt_detail, pdt_img, pdt_amount, pdt_buy, pdt_date_sub, pdt_date_up
			from 
	    		(select /*+ index_desc(product_tbl pk_pdt_num ) */ rownum rn, pdt_num, cg_code, cg_code_prt, pdt_name, pdt_price, pdt_discount, 
	        		pdt_company, pdt_detail, pdt_img, pdt_amount, pdt_buy, pdt_date_sub, pdt_date_up
	    	from product_tbl where pdt_num > 0 and rownum > 0 and 
	 ]]>   	
	 
	    	<include refid="criteria"></include>
	    	
	 <![CDATA[   	
	    	rownum <= #{pageNum} * #{amount})
		where rn  > (#{pageNum}-1) * #{amount}
	]]>
	</select>
	
	<!-- 페이징 -->
	<select id="getTotalCountProduct" resultType="int" >
		select count(*) from product_tbl where 
		
		<include refid="criteria"></include>
		
		<![CDATA[
		pdt_num > 0
		]]>
	</select>
	
	<select id="product_modify" resultType="com.pakmall.domain.ProductVO">
		select * from product_tbl where pdt_num = #{pdt_num}
	</select>
	
	<delete id="product_deleteOK" >
		delete from product_tbl where pdt_num = #{pdt_num}
	</delete>

	

</mapper>